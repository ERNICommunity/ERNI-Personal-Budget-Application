<p-confirmDialog
  [style]="{ width: '50vw' }"
  [baseZIndex]="10000"
  rejectButtonStyleClass="p-button-text"
></p-confirmDialog>
<p-panel>
  <ng-template pTemplate="icons">
    <div class="flex align-items-center">
      <span class="mr-2">{{ budget().amountLeft }} € left out of {{ budget().amount }}</span>

      <a
        *ngIf="budget().isEditable"
        routerLink="new-request/{{ budget().id }}"
      >
        <button
          pButton
          class="btn btn-primary"
          icon="pi pi-plus"
          label="Create Request"
        ></button>
      </a>
    </div>

  </ng-template>
  <ng-template pTemplate="header">
    @if (budget().title) {
      <div>
        @if (budgetIcon()) {
          <span>{{budgetIcon()}} </span>
        }
        <span class="font-bold">{{ budget().title }}</span>
        @if (budgetTypeName()) {
          <span> - {{ budgetTypeName() }}</span>
        }
      </div>
    } @else if (budgetTypeName()) {
      <div>{{ budgetTypeName() }}</div>
    }
  </ng-template>

  <p-progressBar [value]="budgetAmountPercentage()" [color]="budgetAmountProgressColor()">
    <ng-template pTemplate="content" let-value>{{ budget().amountLeft }} €</ng-template>
  </p-progressBar>

  @if (budget().requests.length > 0) {
    <p-table
      [value]="budget().requests"
      styleClass="p-datatable-gridlines p-datatable-striped mt-3"
    >
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th>Title</th>
          <th>Amount</th>
          <th>Create date</th>
          <th>Request State</th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-request>
        <tr>
          <td>{{ request.title }}</td>
          <td class="text-right">{{ request.amount | number : '1.2-2' }}&nbsp;€</td>
          <td>{{ request.createDate | date : "dd/MM/yyyy" }}</td>
          <td>{{ requestStateType[request.state] }}</td>
          <td class="button-table-cell">
            <a routerLink="request/{{ request.id }}" class="p-button p-button-sm p-button-secondary no-underline">
              @if (request.state === requestStateType.Pending) {
                <i class="pi pi-file-edit mr-2"></i>Edit
              } @else {
                <i class="pi pi-file mr-2"></i>Open
              }
            </a>

            <p-button
              *ngIf="request.state === requestStateType.Pending && budget().isEditable"
              icon="pi pi-trash"
              label="Delete"
              [size]="'small'"
              [severity]="'danger'"
              (click)="openDeleteConfirmationModal(request)">
            </p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  }
</p-panel>
