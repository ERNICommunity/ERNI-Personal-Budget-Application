<div class="block mb-2">Attachments</div>

@if (uploadEnabled()) {
  <input #fileUpload type="file" multiple [accept]="acceptedFileTypes" hidden (change)="onFileSelect($event)" />
  <div
    pDroppable
    class="border-dashed border-round-2xl border-400 p-5 mb-2 flex flex-column align-items-center gap-2"
    (onDrop)="onFileSelect($event)">
    <i class="pi pi-cloud-upload text-7xl text-400"></i>
    <p class="text-center m-0">
      <span>Drag & drop to upload or</span>
      <button class="p-link text-primary p-1 py-2 hover:bg-gray-100" role="button" (click)="fileUpload.click()">
        browse
      </button>
    </p>
  </div>
  @if (errorMessage(); as errorMessage) {
    <small class="p-error block mt-2">{{ errorMessage }}</small>
  }
}

@if (uiFileList().length > 0) {
  <ul class="list-none p-0 m-0">
    @for (file of uiFileList(); track file.name) {
      <li>
        <div class="flex align-items-center gap-2 h-full">
          <i class="pi pi-file text-color-secondary"></i>
          <div class="overflow-hidden text-overflow-ellipsis white-space-nowrap text-color-secondary">
            {{ file.name }}
          </div>
          @if (file.status === 'not-uploaded') {
            <div class="ml-auto">
              <button
                class="block p-2 p-button p-button-rounded p-button-link p-button-text p-button-danger"
                (click)="removeFile(file)">
                <i class="pi pi-times" role="button" tabindex="0"></i>
              </button>
            </div>
          }

          @if (file.status === 'uploaded') {
            <div class="ml-auto">
              <button
                class="block p-2 p-button p-button-rounded p-button-link p-button-text p-button-secondary"
                (click)="download(file)">
                <i class="pi pi-download" role="button" tabindex="0"></i>
              </button>
            </div>
          } @else if (file.status === 'downloading') {
            <div class="ml-auto">
              <p-progressSpinner [style]="{ 'margin-right': '2px' }" styleClass="spinner" />
            </div>
          }
        </div>
        @if (file.status === 'uploading') {
          <p-progressBar
            class="upload-progress-bar"
            [style]="{ height: '0.4rem' }"
            [value]="file.progress"
            [showValue]="false" />
        }
      </li>
    }
  </ul>
}
